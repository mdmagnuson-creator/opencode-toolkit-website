## Codebase Patterns
- Next.js 16 with static export configured (output: 'export' in next.config.ts)
- Tailwind CSS v4 with @import "tailwindcss" in globals.css
- Dark mode uses class strategy: `.dark` class on html element
- Theme script in layout.tsx for flash-free dark mode on initial load
- Use neutral color palette for minimal design aesthetic
- Geist font family loaded via next/font/google

---

## 2026-02-19 - US-001: Hero Section

### What was implemented
- Scaffolded Next.js 15+ project with TypeScript, Tailwind CSS v4, ESLint, App Router
- Configured static export in next.config.ts (output: 'export', trailingSlash: true)
- Created Hero Section with:
  - Open Source badge
  - Headline: "An Agent System for opencode"
  - Subheadline: "57 specialized agents working together to build software"
  - Primary CTA linking to #getting-started
  - Secondary CTA with GitHub icon (placeholder # link)
  - Stats row: 57 Agents, 16 Skills, 4 Primary Agents
- Dark mode support via class strategy with system preference detection
- Smooth color transitions between light/dark mode

### Files changed
- next.config.ts - Added static export configuration
- src/app/globals.css - Updated for dark mode class strategy
- src/app/layout.tsx - Added metadata, dark mode script, body classes
- src/app/page.tsx - Created Hero Section component

### Learnings for future iterations
- Tailwind v4 uses @import "tailwindcss" not @tailwind directives
- Dark mode class strategy requires script in <head> to prevent flash
- Use suppressHydrationWarning on html element when injecting client scripts
- Static export creates 'out/' directory with index.html

---

## 2026-02-20 - US-004: Document E2E Testing Agents

### What was implemented
- Added comprehensive "E2E Testing System" section to testing concepts page
- Created E2E workflow diagram showing the complete flow:
  - UI Changes → e2e-reviewer (analyzes) → e2e-areas.json → e2e-playwright (writes) → e2e-tester (runs)
  - Shows pass/fail outcomes (Ready to ship vs Draft PRD created)
- Created detailed agent cards for all 4 E2E agents:
  - e2e-reviewer: Test gap analyzer with amber color theme
  - e2e-playwright: E2E test writer with purple color theme
  - playwright-dev: Playwright automation specialist with indigo color theme
  - e2e-tester: E2E suite runner with green color theme
- Each card includes:
  - Agent name and description
  - Primary output/framework info
  - Key capabilities (6 per agent)
  - Link to full agent documentation page
- Added Key Concepts section explaining:
  - The e2e-areas.json manifest with JSON example
  - How failures become draft PRDs (visual flow diagram)
  - Using the dev server for E2E tests with project.json example

### Files changed
- src/app/concepts/testing/page.tsx - Added E2E Testing System section (~600 lines)

### Learnings for future iterations
- Use distinct color themes for each E2E agent (amber, purple, indigo, green)
- Workflow diagrams with numbered steps are effective for explaining agent chains
- Include JSON code examples in Key Concepts for concrete understanding
- Visual flow diagrams (A → B → C) help explain failure handling workflows

---

## 2026-02-20 - US-005: Document QA Adversarial Testing System

### What was implemented
- Added comprehensive "QA & Adversarial Testing" section to testing concepts page
- Created QA workflow diagram showing the complete flow:
  - qa (coordinates) → qa-explorer (explores) → Bug Findings → qa-browser-tester (converts) → Regression Tests
  - Shows browser-use CLI as the autonomous browsing tool
- Created detailed agent cards for all 3 QA agents:
  - qa: QA Coordinator with orange color theme
  - qa-explorer: Adversarial Testing Agent with red color theme
  - qa-browser-tester: Bug-to-Test Converter with teal color theme
- Each card includes:
  - Agent name and description
  - Input/output information
  - Key capabilities (6 per agent)
  - Link to full agent documentation page
- Added Browser-Use CLI callout explaining:
  - What browser-use is (external tool for AI-controlled browsing)
  - Required dependency for qa-explorer
  - Real browser control, AI-driven exploration, and beyond scripted tests
  - Link to browser-use documentation
- Added "Why Adversarial Testing?" section with three benefit cards:
  - Finds Edge Cases
  - Simulates Real Users
  - Permanent Protection (bugs become regression tests)

### Files changed
- src/app/concepts/testing/page.tsx - Added QA & Adversarial Testing section (~650 lines)

### Learnings for future iterations
- Use distinct color themes for QA agents (orange for coordinator, red for explorer, teal for browser-tester)
- External dependencies should be prominently documented with callout boxes
- Violet/purple theme works well for external tools like browser-use CLI
- "Why" sections with benefit cards help explain the value proposition of testing approaches

---

## 2026-02-20 - US-003: Document Unit Test Specialists

### What was implemented
- Added new "Unit Test Specialists" section to testing concepts page
- Created detailed agent cards for each specialist:
  - jest-tester: Backend JS/TS testing with Jest
  - react-tester: React component testing with RTL + Jest
  - go-tester: Go testing with testify and httptest
- Each card includes:
  - Agent name and description
  - File patterns handled (*.ts, *.js, *.tsx, *.jsx, *.go)
  - Testing framework used
  - Key capabilities (6 per agent)
  - Link to full agent documentation page
- Added Project-Specific Overrides section explaining:
  - How to override global testers with project versions
  - Directory structure example (docs/agents/)
  - Common use cases for customization
  - Override priority note

### Files changed
- src/app/concepts/testing/page.tsx - Added Unit Test Specialists section (~500 lines)

### Learnings for future iterations
- Agent cards should use semantic color coding (blue for jest, purple for react, cyan for go)
- Project override documentation should include concrete file path examples
- Capabilities lists work well in 2-column grids on larger screens

---

## 2026-02-20 - US-006: Document E2E Quality Patterns Skill

### What was implemented
- Added comprehensive "E2E Quality Patterns" section to testing concepts page
- Documented all 7 quality patterns with code examples:
  - assertNeverAppears: Verify elements never flash/flicker during actions
  - withPerformanceBudget: Enforce time/memory constraints as assertions
  - assertNoLayoutShift: Track element positions before/after actions
  - assertStableRender: Monitor content stability over time
  - measureCLS: Measure Cumulative Layout Shift via Performance Observer
  - assertStateStability: Verify desired states don't regress
  - expectMutualExclusivity: Assert UI states never coexist
- Added "When to Use Quality Patterns" guidance box
  - Lists quality pattern use cases (loading states, drag-drop, animations)
  - Lists when basic assertions suffice (form validation, navigation, CRUD)
- Added link to full e2e-quality skill documentation page
- Used pink color theme to distinguish from other testing sections
- All patterns include "Use when:" guidance notes

### Files changed
- src/app/concepts/testing/page.tsx - Added E2E Quality Patterns section (~460 lines)

### Learnings for future iterations
- Pink color theme works well for quality/polish patterns (not used elsewhere)
- Code examples should show realistic use cases, not toy examples
- Each pattern benefits from a specific "Use when:" note
- Link components should use Next.js <Link> not <a> for internal navigation

---

## 2026-02-20 - US-008: Add Mutation Testing Requirements Concept

### What was implemented
- Added comprehensive "Mutation Testing Pattern" section to testing concepts page
- Documented the 3-stage verification approach for state-changing operations:
  1. **Immediate State**: Assert right after action (catches validation errors, action handler bugs)
  2. **Stable State**: Assert after async operations settle (catches race conditions, optimistic UI mismatches)
  3. **Persistence**: Assert after page reload/re-fetch (catches persistence bugs, cache issues, serialization)
- Created visual cards for each verification stage with:
  - Icon, title, and description
  - What it catches (common bugs)
  - Code snippet showing the assertion pattern
- Added full Playwright code example showing all three stages together
- Added "Why Each Stage Matters" section explaining what bugs each stage catches
- Added additional code examples for delete and create operations
- Added "When to Apply" callout with use case tags (CRUD, form submissions, settings, workflow transitions)
- Used sky/cyan color theme to distinguish from other sections (pink for quality, purple for E2E, orange for QA, blue for unit)

### Files changed
- src/app/concepts/testing/page.tsx - Added Mutation Testing Pattern section (~340 lines)

### Learnings for future iterations
- Sky/cyan color theme available for new testing sections
- Visual stage cards with code snippets help explain multi-step patterns
- "When to Apply" sections with tags help users quickly identify relevant use cases
- The 3-stage pattern is particularly important for E2E tests that verify state changes

---

## 2026-02-20 - US-009: Update Testers Category Page

### What was implemented
- Updated testers category description to explain the testing system hierarchy
- Added tester functional groups for specialized display:
  - Orchestrator: tester
  - Unit Specialists: jest-tester, react-tester, go-tester
  - E2E Testing: e2e-playwright
  - QA & Adversarial: qa, qa-explorer, qa-browser-tester
  - Supporting: merge-coordinator
- Created grouped view when filtering to testers category with sub-headers and descriptions
- Added cross-references between related agents showing relationships:
  - tester "Routes to" unit specialists
  - qa "Coordinates" qa-explorer and qa-browser-tester
  - qa-explorer "Reports to" qa
  - qa-browser-tester "Works with" qa-explorer
- Added link to Testing Concepts page at top of testers view
- Enhanced AgentCard component with optional showCrossRefs prop

### Files changed
- src/app/agents/sub/page.tsx - Added tester grouping constants, cross-references, and specialized testers view

### Learnings for future iterations
- Category-specific views can provide more context than flat lists
- Cross-references help users understand agent relationships
- Green accent colors work well for testers category (consistent with existing badge colors)
- Grouped views benefit from descriptions explaining each group's purpose

---

## 2026-02-21 - US-010: Update Concepts Navigation

### What was implemented
- Added Quick Links subsection to Testing System card on concepts page
- Links to 4 testing sub-topics: Architecture Overview, Test Flow Automation, E2E Quality Patterns, Mutation Testing
- Added Quick Navigation section at top of testing concepts page with colored icon buttons
- Each quick link has a distinct color theme matching the target section's color
- Added anchor IDs to 4 sections: #architecture, #test-flow, #quality-patterns, #mutation-testing
- Updated concepts card rendering to support optional subLinks property

### Files changed
- src/app/concepts/page.tsx - Added subLinks to Testing System concept, updated card rendering
- src/app/concepts/testing/page.tsx - Added Quick Navigation section, added IDs to key sections

### Learnings for future iterations
- Anchor links with matching color themes help users preview what section they're navigating to
- Quick Navigation grids work well with 4 items (responsive 2x2 on mobile, 1x4 on desktop)
- subLinks pattern on concept cards can be reused for other concepts that have sub-sections
- Section IDs should be short and kebab-case for cleaner URLs

---

## 2026-02-21 - US-001, US-002, US-004, US-005, US-007: Verified Existing Documentation

### What was verified
- US-001 (Testing Architecture Overview): Already implemented with Testing Agent Hierarchy diagram and Three Operational Modes
- US-002 (Document Tester Orchestrator): Already implemented with How the Tester Orchestrator Works section, routing logic, retry handling
- US-004 (Document E2E Testing Agents): Already implemented with E2E Testing System section and 4 agent cards
- US-005 (Document QA Adversarial Testing): Already implemented with QA & Adversarial Testing section
- US-007 (Document Test Flow Skill): Already implemented with Test Flow Automation section

### Files verified
- src/app/concepts/testing/page.tsx - All sections present and complete

---

## 2026-02-21 - US-011: Verify Build-Time Sync Accuracy

### What was implemented
- Fixed categorization logic in extract-toolkit-data.ts
- Added explicit checks for e2e-, qa-, and playwright-dev to be categorized as testers
- Excluded merge-coordinator from testers category (it's coordination, not testing)
- Verified all 10 testers are now correctly extracted
- Verified both testing skills (test-flow, e2e-quality) are extracted

### Files changed
- scripts/extract-toolkit-data.ts - Updated categorizeAgent() function
- src/data/toolkit-manifest.json - Regenerated with correct categories

### Learnings for future iterations
- Agent categorization is based on name and description patterns
- Order of pattern matching matters - specific patterns should come before generic ones
- E2E and QA agents should be categorized as testers even if they have "reviewer" or "dev" in name

---

## 2026-02-21 - US-006: Deprecate Old Extraction Script

### What was implemented
- Removed `scripts/extract-toolkit-data.ts` (deprecated custom extraction script)
- Removed `scripts/generate-manifest.ts` (deprecated manifest generation script)
- Updated `package.json` scripts:
  - Removed `extract-data` script
  - Added `fetch-data` script for fetching manifest from GitHub/local
  - Changed `prepare-data` to use `fetch-data → transform-data` flow
  - Updated comment about Windows compatibility
- Updated `src/data/types.ts` comment to reference new transform script
- Updated `docs/review.md` to remove obsolete reference to deprecated script

### Files changed
- scripts/extract-toolkit-data.ts - DELETED
- scripts/generate-manifest.ts - DELETED
- package.json - Updated scripts section
- src/data/types.ts - Updated comment
- docs/review.md - Removed obsolete minor issue

### Learnings for future iterations
- New data flow: `fetch-toolkit-manifest.ts` → `transform-toolkit-structure.ts`
- Fetch script tries GitHub first, falls back to local `~/code/ai-toolkit/toolkit-structure.json`
- Transform script converts toolkit-structure.json format to website's toolkit-manifest.json format
- CI builds no longer need local toolkit clone - fetch from GitHub raw URL

---

## 2026-02-21 - US-007: Implement New Agent Category Structure

### What was implemented
- Split 'other' category into 'orchestrators' (3 agents) and 'utilities' (7 agents)
- Added Primary Agents section at top of agents page with dedicated PrimaryAgentCard component
- Updated category colors: Orchestrators (Purple), Utilities (Gray/Slate)
- Added backwards compatibility via CATEGORY_ALIASES mapping 'other' → 'utilities'
- Updated all pages that reference agent categories:
  - src/app/agents/page.tsx - Main agents page with Primary section
  - src/app/agents/[slug]/page.tsx - Agent detail page
  - src/app/agents/primary/page.tsx - Primary agents page
  - src/app/agents/sub/page.tsx - Sub-agents page
  - src/app/page.tsx - Home page (5-column grid for categories)
  - src/app/concepts/agents/page.tsx - Agents concepts page
  - src/components/AgentAvatar.tsx - Avatar with category colors
  - src/components/AgentRelationshipDiagram.tsx - Relationship diagram

### Files changed
- src/data/types.ts - Updated Agent category union type
- src/data/index.ts - Updated getAgentsByCategory function signature
- scripts/transform-toolkit-structure.ts - Split operational into orchestrators/utilities
- src/data/toolkit-manifest.json - Regenerated with new categories
- src/app/agents/page.tsx - Added Primary section, new categories
- src/app/agents/[slug]/page.tsx - Updated category labels/colors
- src/app/agents/primary/page.tsx - Updated category labels/colors
- src/app/agents/sub/page.tsx - Updated all category references
- src/app/page.tsx - Updated to 5-column grid with new categories
- src/app/concepts/agents/page.tsx - Updated to 5-column grid
- src/components/AgentAvatar.tsx - Added orchestrators/utilities styles
- src/components/AgentRelationshipDiagram.tsx - Added new category counts

### Learnings for future iterations
- Category changes require updates across many files - consider shared constants
- CATEGORY_ALIASES pattern provides clean backwards compatibility
- Orchestrators: agents that coordinate (felix, prd, prd-impact-analyzer)
- Utilities: standalone tools (debugger, wall-e, session-status, docs-writer, etc.)
- Primary agents get special styling with gradient backgrounds and violet accent

---

## 2026-02-21 - US-002: Document how humans work with Planner

### What was implemented
- Added comprehensive "Working with Planner" section to Human Work Modes page
- Created "The Draft-to-Ready Journey" with 4-step visual timeline:
  1. Create a Draft PRD
  2. Refine Requirements
  3. Clarify Scope
  4. Mark as Ready
- Added "Draft Refinement Tips" with 4 actionable cards:
  - Challenge the stories (edge cases, error handling)
  - Split large stories (4-5 AC max)
  - Define "done" clearly (specific criteria)
  - Check dependencies (ordering)
- Added "Clarifying Scope" section with In Scope / Out of Scope checklist
- Added "Practical Prompts for Planning Sessions" with 5 copy-ready prompts:
  - New Feature: Starting a planning session
  - Refine Draft: Continuing refinement
  - Edge Cases: Adding error handling
  - Scope Check: Verifying boundaries
  - Mark Ready: Finalizing PRD
- Added "When to Use Planner vs Builder" comparison table
- Updated "Coming Soon" section to focus on Builder & Toolkit guides

### Files changed
- src/app/concepts/human-work-modes/page.tsx - Added ~450 lines for Planner section

### Learnings for future iterations
- Violet color theme for Planner (consistent with overview cards)
- Timeline-style step lists with connecting lines work well for journeys
- Copy-ready prompts should include category badges (New Feature, Refine Draft, etc.)
- Comparison tables help users understand when to use which agent

---

## 2026-02-21 - US-003: Document how humans work with Builder

### What was implemented
- Added comprehensive "Working with Builder" section to Human Work Modes page
- Created "Two Operating Modes" subsection with detailed cards:
  - PRD Mode: systematic story-by-story execution with auto-generated tests
  - Ad-hoc Mode: immediate execution for quick fixes and one-off tasks
- Added "When to Use Each Mode" comparison table with 6 common scenarios
- Created "The Update Flow" section with visual flow diagram showing:
  - Agent discovers gap → queues in pending-updates/ → @toolkit applies → @builder applies project updates
  - Includes user control note about reviewing and approving updates
- Added "Expected Outcomes" section with outcome lists for both modes
- Created "Practical Prompts for Builder Sessions" with 5 copy-ready prompts:
  - PRD Mode: starting implementation, continuing work
  - Ad-hoc: bug fix, refactoring, adding API endpoint
- Added "Pro Tips for Working with Builder" callout box
- Updated "Coming Soon" section to only mention Toolkit (Builder now documented)

### Files changed
- src/app/concepts/human-work-modes/page.tsx - Added ~550 lines for Builder section
- docs/prd.json - Marked US-003 as passes: true

### Learnings for future iterations
- Blue color theme for Builder, purple for ad-hoc mode (distinguishes the two modes visually)
- Side-by-side cards work well for comparing two operational modes
- Update flow diagrams with numbered steps help explain multi-agent coordination
- Expected outcomes lists with bullet points give users clear success criteria
- Pro tips boxes at the end of sections provide valuable quick reference

---

## 2026-02-21 - US-005: Define end-to-end human operating loops

### What was implemented
- Added comprehensive "End-to-End Operating Loops" section to Human Work Modes page
- Created three concrete operating loops:
  1. **New Feature Loop**: Planner → Builder → (optional Toolkit) → Ship
     - 4 steps with handoff points marked between each
     - Shows PRD ready handoff, optional toolkit gap queuing, and PR completion
     - Completion criteria: all stories pass, tests pass, PR merged, PRD archived
  2. **Quick Fix Loop**: Builder (ad-hoc) → Verify → Ship
     - 3 steps for bug fixes and quick improvements
     - No PRD overhead, direct implementation
     - Completion criteria: fix committed, quality gates pass, changes pushed
  3. **Toolkit Sync Loop**: Toolkit review → Apply → Builder verify → Done
     - 4 steps for periodic toolkit maintenance
     - Shows review/approve decision point and verification step
     - Completion criteria: updates reviewed, changes committed, verified on project
- Added "Choosing the Right Loop" summary table with 5 common scenarios
- Added "Pro Tips for Operating Loops" callout with 4 best practices
- Used emerald color theme for section, purple for Quick Fix loop, amber for Toolkit Sync loop
- All loops include:
  - Clear handoff arrows with labels
  - Agent badges (violet for Planner, blue for Builder, amber for Toolkit, green for Done)
  - Completion criteria checklists
  - Copy-ready prompt examples

### Files changed
- src/app/concepts/human-work-modes/page.tsx - Added ~700 lines for Operating Loops section
- docs/prd.json - Marked US-005 as passes: true

### Learnings for future iterations
- Emerald color theme works well for meta/coordination sections
- Dashed borders help distinguish optional steps from required ones
- Handoff arrows with uppercase labels create clear visual flow
- Completion criteria checklists give users confidence in when a loop is truly done
- Summary tables help users quickly match their situation to the right workflow

---

## 2026-02-21 - US-006: Add actionable quick-start prompts

### What was implemented
- Added new "Quick Start Prompts" section to Human Work Modes page (after Operating Loops)
- Section includes 16 copy-ready prompts using CodeBlockWithCopy component:
  - **Planner prompts (4)**: new feature, refine draft PRD, mark ready, split story
  - **Builder prompts (7)**: organized by PRD Mode (3) and Ad-hoc Mode (4)
    - PRD Mode: start implementing, continue with story, implement specific story
    - Ad-hoc Mode: fix bug, add quick feature, refactor code, add tests
  - **Toolkit prompts (5)**: review pending updates, create skill, update agent, audit coverage, create scaffold
- Each prompt card includes:
  - Descriptive title for the use case
  - Copy button for one-click clipboard copy
  - Bracketed placeholders for user-specific details
- Added "Prompt Tips" card at section end with 4 best practices:
  - Be specific (concrete > vague)
  - Include context (file paths, error messages)
  - State constraints (what NOT to change)
  - Use the right agent (routing guidance)
- Used indigo color theme for section header with rocket icon
- Fixed 3 failing tests by updating queries to use getAllBy* variants for intentionally duplicate content

### Files changed
- src/app/concepts/human-work-modes/page.tsx - Added ~250 lines for Quick Start Prompts section
- src/app/concepts/human-work-modes/__tests__/page.test.tsx - Fixed 3 tests (lines 27-34, 697-705, 1629-1638)
- docs/prd.json - Marked US-006 as passes: true

### Learnings for future iterations
- CodeBlockWithCopy component provides real copy functionality (unlike styled spans)
- When adding content that duplicates existing text, tests using getBy* need to switch to getAllBy*
- Indigo color theme available for new sections (not used elsewhere on this page)
- Organizing prompts by mode (PRD Mode vs Ad-hoc Mode) helps users find what they need quickly
- Prompt tips should be actionable and specific ("Fix the login form" > "Fix the bug")

---

## 2026-02-22 - PRD: Hybrid Changelog Sync (US-001 through US-006)

### What was implemented
- **US-001: Hybrid Architecture Contract**
  - Baseline source: build-time manifest (toolkit-manifest.json)
  - Runtime source: GitHub fetch (toolkit-structure.json raw URL)
  - Precedence: runtime overrides baseline when successful
  - Fallback: use baseline when runtime fails

- **US-002: Runtime Fetcher**
  - Created `/src/lib/changelog-fetcher.ts` with fetchToolkitChangelog()
  - Validates and normalizes external payload shape
  - Handles network failures safely with try/catch

- **US-003: Changelog Merge**
  - Added mergeChangelogs() function in `/src/data/index.ts`
  - Merges runtime/baseline toolkit data with website changelog
  - Sorted by day, newest-first

- **US-004: Loading/Stale/Fallback States**
  - Created `/src/app/changelog/ChangelogClient.tsx` (Client Component)
  - Shows loading spinner while fetching
  - Shows amber warning banner on fallback/error
  - Works in both light and dark mode

- **US-005: TTL Caching & Refresh**
  - 15-minute TTL cache in localStorage
  - Cache key includes version for invalidation
  - Manual refresh button bypasses cache

- **US-006: Instrumentation**
  - FetchOutcome type with status: 'success' | 'stale-cache' | 'fallback' | 'failure'
  - Console logging for debugging
  - UI remains functional across all network states

- **Bonus: Metadata Fixes**
  - Header.tsx: Dynamic counts from manifest (agents, skills)
  - SearchModal.tsx: Dynamic page descriptions from manifest

### Files created
- `/src/lib/changelog-fetcher.ts` - Runtime fetcher with caching, validation, instrumentation
- `/src/app/changelog/ChangelogClient.tsx` - Client component for hybrid changelog UI
- `/src/components/HybridChangelog.tsx` - Alternative component (may be unused)

### Files changed
- `/src/data/index.ts` - Added mergeChangelogs(), getBaselineToolkitChangelog()
- `/src/app/changelog/page.tsx` - Simplified to Server Component delegating to client
- `/src/components/Header.tsx` - Dynamic navigation counts
- `/src/components/SearchModal.tsx` - Dynamic page descriptions
- `/docs/prd.json` - Marked all stories passes: true
- `/docs/builder-state.json` - Updated session state
- `/docs/prd-registry.json` - Moved PRD to completed

### Learnings for future iterations
- Server Components cannot pass render functions to Client Components
- Split pattern: Server Component for SSR baseline + Client Component for runtime enhancement
- localStorage caching requires 'use client' directive
- GitHub raw URLs: https://raw.githubusercontent.com/{owner}/{repo}/{branch}/{path}
- FetchOutcome pattern useful for tracking data freshness states
